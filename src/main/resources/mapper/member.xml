<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.interviewgo.mapper.MemberMapper">
<<<<<<< HEAD

    <select id="getMemberByUsername" resultType="member">
        SELECT *
        FROM member
        WHERE username = #{username}
    </select>

    <select id="countByUsername" parameterType="String" resultType="int">
=======
	<!-- 사용자 정보 입력 (임시) -->
	<!-- <insert id="insertMember" parameterType="com.interviewgo.dto.MemberDTO">
		insert into member(username,mb_password,mb_nickname,mb_pnumber,role,mb_date)	
		values(#{username},#{mb_password},#{mb_nickname},#{mb_pnumber},#{role},now())
	</insert> -->
	
	<!-- username 중복검사 -->
	<select id="countByUsername" parameterType="String" resultType="int">
>>>>>>> origin/kwon2
        SELECT COUNT(*) 
        FROM member 
        WHERE username = #{username}
    </select>

<<<<<<< HEAD
    <select id="checkUserExists" parameterType="member" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE username = #{username}
          AND mb_pnumber = #{mb_pnumber}
    </select>


    <insert id="insertMember" parameterType="member">
=======
	<!-- 회원가입 -->	
	<insert id="insertMember" parameterType="com.interviewgo.dto.MemberDTO">
>>>>>>> origin/kwon2
        INSERT INTO member (
            username, 
            mb_password, 
            mb_nickname, 
            mb_pnumber, 
            role, 
            mb_date,
            mb_icon
        ) VALUES (
            #{username}, 
            #{mb_password}, 
            #{mb_nickname}, 
            #{mb_pnumber}, 
            #{role}, 
            NOW(),
            '/images/default.png'
        )
    </insert>

<<<<<<< HEAD

    <update id="updatePassword" parameterType="member">
        UPDATE member
        SET mb_password = #{mb_password}
        WHERE username = #{username}
    </update>

    <update id="updateMember" parameterType="member">
        UPDATE member
        <set>
            <if test="mb_password != null and mb_password != ''">
                mb_password = #{mb_password},
            </if>
            <if test="mb_nickname != null and mb_nickname != ''">
                mb_nickname = #{mb_nickname},
            </if>
            <if test="mb_pnumber != null and mb_pnumber != ''">
                mb_pnumber = #{mb_pnumber},
            </if>
            <if test="mb_icon != null and mb_icon != ''">
                mb_icon = #{mb_icon},
            </if>
        </set>
        WHERE mb_uid = #{mb_uid}
    </update>


    <select id="getMemberByUid" resultType="member">
        SELECT *
        FROM member
        WHERE mb_uid = #{mbUid}
    </select>

    <select id="selectPassword" parameterType="Long" resultType="string">
        SELECT mb_password
        FROM member
        WHERE mb_uid = #{mb_uid}
    </select>

    <select id="checkNicknameDuplicate" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE mb_nickname = #{nickname}
          AND mb_uid != #{mb_uid}
    </select>


    <select id="selectExamHistory" parameterType="Long" resultType="interviewHistory">
        SELECT
            h.hist_uid,
            h.hist_score,
            h.hist_date,
            e.ex_title,
            e.ex_level,
            l.ex_lang_name
        FROM exam_history h
        INNER JOIN exam e ON h.ex_uid = e.ex_uid AND h.ex_lang_uid = e.ex_lang_uid
        INNER JOIN exam_language l ON h.ex_lang_uid = l.ex_lang_uid
        WHERE h.mb_uid = #{mb_uid}
        ORDER BY h.hist_date DESC
    </select>

    <select id="selectInterviewHistory" parameterType="Long" resultType="interviewHistory">
        SELECT *
        FROM interview_history
        WHERE mb_uid = #{mb_uid}
        ORDER BY iv_date DESC
    </select>


    <delete id="deleteExamHistory" parameterType="Long">
        DELETE FROM exam_history WHERE mb_uid = #{mb_uid}
    </delete>

    <delete id="deleteInterviewHistory" parameterType="Long">
        DELETE FROM interview_history WHERE mb_uid = #{mb_uid}
    </delete>

    <delete id="deleteMember" parameterType="Long">
        DELETE FROM member WHERE mb_uid = #{mb_uid}
    </delete>

=======
	<!-- 사용자 정보 가져오기 (임시) -->
	<!-- <select id="getMember" parameterType="Long">
      SELECT * FROM member WHERE mb_uid = #{mb_uid}
	</select> -->
	
	<select id="getMemberById" parameterType="String">
		SELECT * FROM member WHERE username = #{username}
	</select>
	
	<!-- 사용자 정보 갱신 (임시) -->
	<update id="updateMember" parameterType="com.interviewgo.dto.MemberDTO">
		UPDATE member
		SET
			mb_password = #{mb_password}
			mb_nickname = #{mb_nickname}
			mb_pnumber = #{mb_punumber}
			mb_icon = #{mb_icon}
		WHERE mb_uid = #{mb_uid}
	</update>
	
	<!-- 비번찾기(회원인증) -->
	<select id="checkUserExists" parameterType="member" resultType="int">
        select count(*)
        from member
        where username = #{username}
          and mb_pnumber = #{mb_pnumber}
    </select>

	<!-- 임시비번 업데이트 -->
    <update id="updatePassword" parameterType="member" >
       update member
        set mb_password = #{mb_password}
        where username = #{username}
    </update>
>>>>>>> origin/kwon2
</mapper>